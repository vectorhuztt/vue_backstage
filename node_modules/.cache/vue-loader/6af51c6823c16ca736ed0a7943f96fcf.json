{"remainingRequest":"E:\\MyStudyPro\\vue_file\\vue_backstage\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\MyStudyPro\\vue_file\\vue_backstage\\src\\components\\power\\Roles.vue?vue&type=style&index=0&id=08ac19b3&lang=less&scoped=true&","dependencies":[{"path":"E:\\MyStudyPro\\vue_file\\vue_backstage\\src\\components\\power\\Roles.vue","mtime":1587609420834},{"path":"E:\\MyStudyPro\\vue_file\\vue_backstage\\node_modules\\css-loader\\dist\\cjs.js","mtime":1587210267966},{"path":"E:\\MyStudyPro\\vue_file\\vue_backstage\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1587210275486},{"path":"E:\\MyStudyPro\\vue_file\\vue_backstage\\node_modules\\postcss-loader\\src\\index.js","mtime":1587210273238},{"path":"E:\\MyStudyPro\\vue_file\\vue_backstage\\node_modules\\less-loader\\dist\\cjs.js","mtime":1587210270806},{"path":"E:\\MyStudyPro\\vue_file\\vue_backstage\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1587210266454},{"path":"E:\\MyStudyPro\\vue_file\\vue_backstage\\node_modules\\vue-loader\\lib\\index.js","mtime":1587210275486}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKDQoucm93IHsNCiAgICBtYXJnaW4tdG9wOiAycHg7DQp9DQouZWwtdGFnIHsNCiAgICBtYXJnaW46IDdweDsNCn0NCi5iZF9ib3R0b20gew0KICAgIGJvcmRlci1ib3R0b206IDFweCBzb2xpZCAjZWVlOw0KfQ0KLmJkX3RvcCB7DQogICAgYm9yZGVyLXRvcDogMXB4IHNvbGlkICNlZWU7DQp9DQoudmNlbnRlciB7DQogICAgZGlzcGxheTogZmxleDsNCiAgICBhbGlnbi1pdGVtczogY2VudGVyOw0KfQ0K"},{"version":3,"sources":["Roles.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAqaA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Roles.vue","sourceRoot":"src/components/power","sourcesContent":["<template>\r\n    <div>\r\n        <breadcrumb>\r\n            <span slot=\"first-title\">权限管理</span>\r\n            <span slot=\"second-title\">角色列表</span>\r\n        </breadcrumb>\r\n        <el-card>\r\n            <el-button type=\"primary\" @click=\"addRoleDialog = true\"\r\n                >添加角色</el-button\r\n            >\r\n            <!-- 角色列表 -->\r\n            <re-table\r\n                :dataList=\"roleList\"\r\n                :tableInfo=\"RoleTableInfo\"\r\n                :hasExpand=\"has_expand\"\r\n            >\r\n                <template slot-scope=\"expand\" slot=\"expand\">\r\n                    <div class=\"row\">\r\n                        <el-row\r\n                            :class=\"[\r\n                                'bd_bottom',\r\n                                index === 0 ? 'bd_top' : '',\r\n                                'vcenter',\r\n                            ]\"\r\n                            v-for=\"(first_item, index) in expand.data.children\"\r\n                            :key=\"first_item.id\"\r\n                            class=\"vcenter\"\r\n                        >\r\n                            <el-col :span=\"5\">\r\n                                <el-tag\r\n                                    type=\"primary\"\r\n                                    closable\r\n                                    @close=\"\r\n                                        removeLabelById(\r\n                                            expand.data,\r\n                                            first_item.id\r\n                                        )\r\n                                    \"\r\n                                >\r\n                                    {{ first_item.label_name }}\r\n                                </el-tag>\r\n                                <i class=\"el-icon-caret-right\"></i>\r\n                            </el-col>\r\n                            <el-col :span=\"19\">\r\n                                <el-row\r\n                                    :class=\"[\r\n                                        index2 === 0 ? '' : 'bd_top',\r\n                                        'vcenter',\r\n                                    ]\"\r\n                                    v-for=\"(second_item,\r\n                                    index2) in first_item.children\"\r\n                                    :key=\"second_item.id\"\r\n                                >\r\n                                    <el-col :span=\"6\">\r\n                                        <el-tag\r\n                                            type=\"success\"\r\n                                            closable\r\n                                            @close=\"\r\n                                                removeLabelById(\r\n                                                    expand.data,\r\n                                                    second_item.id\r\n                                                )\r\n                                            \"\r\n                                            >{{\r\n                                                second_item.label_name\r\n                                            }}</el-tag\r\n                                        >\r\n                                        <i class=\"el-icon-caret-right\"></i>\r\n                                    </el-col>\r\n                                    <el-col :span=\"18\">\r\n                                        <el-tag\r\n                                            type=\"warning\"\r\n                                            v-for=\"(third_item,\r\n                                            index3) in second_item.children\"\r\n                                            :key=\"third_item.id\"\r\n                                            closable\r\n                                            @close=\"\r\n                                                removeLabelById(\r\n                                                    expand.data,\r\n                                                    third_item.id\r\n                                                )\r\n                                            \"\r\n                                        >\r\n                                            {{ third_item.label_name }}\r\n                                        </el-tag>\r\n                                    </el-col>\r\n                                </el-row>\r\n                            </el-col>\r\n                        </el-row>\r\n                    </div>\r\n                </template>\r\n                <template slot-scope=\"role\" slot=\"action\">\r\n                    <el-button\r\n                        type=\"primary\"\r\n                        size=\"mini\"\r\n                        icon=\"el-icon-edit\"\r\n                        @click=\"showUpdateDialog(role.data.id)\"\r\n                        >修改</el-button\r\n                    >\r\n                    <el-button\r\n                        type=\"danger\"\r\n                        size=\"mini\"\r\n                        icon=\"el-icon-delete\"\r\n                        @click=\"removeRoleById(role.data.id)\"\r\n                        >删除</el-button\r\n                    >\r\n                    <el-tooltip\r\n                        class=\"item\"\r\n                        effect=\"dark\"\r\n                        content=\"分配角色\"\r\n                        placement=\"top\"\r\n                        :enterable=\"false\"\r\n                    >\r\n                        <el-button\r\n                            type=\"warning\"\r\n                            size=\"mini\"\r\n                            icon=\"el-icon-setting\"\r\n                            @click=\"showSetPower(role)\"\r\n                            >分配权限</el-button\r\n                        >\r\n                    </el-tooltip>\r\n                </template>\r\n            </re-table>\r\n            <!-- 分配权限面板 -->\r\n            <re-dialog\r\n                :title=\"`分配权限`\"\r\n                :isShow=\"powerDialog\"\r\n                @dialog-cancel=\"setPowerDialogClosed\"\r\n                @dialog-confirm=\"setRolePower\"\r\n            >\r\n                <el-tree\r\n                    slot=\"content\"\r\n                    :data=\"labelTreeList\"\r\n                    :props=\"treeProps\"\r\n                    node-key=\"id\"\r\n                    show-checkbox\r\n                    default-expand-all\r\n                    ref=\"treeRef\"\r\n                    :default-checked-keys=\"defalutKeys\"\r\n                ></el-tree>\r\n            </re-dialog>\r\n            <re-dialog\r\n                :title=\"`添加角色`\"\r\n                :isShow=\"addRoleDialog\"\r\n                @dialog-cancel=\"cancelAddRoleDialog\"\r\n                @dialog-confirm=\"addRole\"\r\n            >\r\n                <re-form\r\n                    slot=\"content\"\r\n                    :formData=\"addFormInfo\"\r\n                    :formRules=\"formRules\"\r\n                    ref=\"addFormRef\"\r\n                ></re-form>\r\n            </re-dialog>\r\n\r\n            <re-dialog\r\n                :title=\"`修改角色`\"\r\n                :isShow=\"updateRoleDialog\"\r\n                @dialog-cancel=\"cancelUpdateRoleDialog\"\r\n                @dialog-confirm=\"changeRoleInfo\"\r\n            >\r\n                <re-form\r\n                    slot=\"content\"\r\n                    :formData=\"updateFormInfo\"\r\n                    :formRules=\"formRules\"\r\n                    ref=\"updateFormRef\"\r\n                ></re-form>\r\n            </re-dialog>\r\n        </el-card>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\nimport {\r\n    getRolesList,\r\n    removeRoleLabel,\r\n    getLabelData,\r\n    updateRoleLabel,\r\n    createRole,\r\n    updateRole,\r\n    deleteRole,\r\n    getRoleDetail,\r\n} from 'network/api_url.js';\r\nimport Breadcrumb from '../common/Breadcrumb';\r\nimport ReForm from '../common/ReForm';\r\nimport ReTable from '../common/ReTable';\r\nimport ReDialog from '../common/ReDialog';\r\nexport default {\r\n    name: 'Role',\r\n    data() {\r\n        return {\r\n            loading: true,\r\n            has_expand: true,\r\n            roleId: '',\r\n            roleList: [],\r\n            labelTreeList: [],\r\n            // 默认选中的节点\r\n            defalutKeys: [],\r\n            powerDialog: false,\r\n            addRoleDialog: false,\r\n            updateRoleDialog: false,\r\n            RoleTableInfo: [\r\n                { title: '角色名称', prop: 'role_name' },\r\n                { title: '角色描述', prop: 'role_desc' },\r\n                { title: '操作', slot: true, name: 'action' },\r\n            ],\r\n            treeProps: {\r\n                children: 'children',\r\n                label: 'label_name',\r\n            },\r\n            formRules: {\r\n                role_name: [\r\n                    {\r\n                        required: true,\r\n                        message: '请输入角色名称',\r\n                        trigger: 'blur',\r\n                    },\r\n                    { min: 3, max: 15, message: '角色名长度在3-15之间' },\r\n                ],\r\n                role_desc: [\r\n                    {\r\n                        required: true,\r\n                        message: '请输入角色描述',\r\n                        trigger: 'blur',\r\n                    },\r\n                    { min: 3, max: 256, message: '角色名长度在3-256之间' },\r\n                ],\r\n            },\r\n            addFormInfo: {\r\n                formFields: {\r\n                    role_name: '',\r\n                    role_desc: '',\r\n                },\r\n                itemData: [\r\n                    {\r\n                        label: '角色名称',\r\n                        prop: 'role_name',\r\n                        name: 'role_name',\r\n                        type: 'text',\r\n                    },\r\n                    {\r\n                        label: '角色描述',\r\n                        prop: 'role_desc',\r\n                        name: 'role_desc',\r\n                        type: 'textarea',\r\n                    },\r\n                ],\r\n            },\r\n            updateFormInfo: {\r\n                formFields: {},\r\n                itemData: [\r\n                    {\r\n                        label: '角色名称',\r\n                        prop: 'role_name',\r\n                        name: 'role_name',\r\n                        type: 'text',\r\n                    },\r\n                    {\r\n                        label: '角色描述',\r\n                        prop: 'role_desc',\r\n                        name: 'role_desc',\r\n                        type: 'textarea',\r\n                    },\r\n                ],\r\n            },\r\n        };\r\n    },\r\n    created() {\r\n        this.getRoleData();\r\n    },\r\n    methods: {\r\n        getRoleData() {\r\n            getRolesList().then((res) => {\r\n                if (res.data.code !== 200) {\r\n                    console.log(res.data);\r\n                    return this.$message.error(res.data.msg);\r\n                }\r\n                this.roleList = res.data.data;\r\n            });\r\n        },\r\n        removeLabelById(role, label_id) {\r\n            const parmas = {\r\n                role_id: role.id,\r\n                label_id,\r\n            };\r\n            console.log(parmas);\r\n            this.$confirm('此操作将删除该角色已拥有的权限, 是否继续?', '提示', {\r\n                confirmButtonText: '确定',\r\n                cancelButtonText: '取消',\r\n                type: 'warning',\r\n            }).then(\r\n                (success) => {\r\n                    removeRoleLabel(parmas).then((res) => {\r\n                        console.log(res.data);\r\n                        if (res.data.code !== 200) {\r\n                            return this.$message.error(res.data.msg);\r\n                        }\r\n                        role.children = res.data.data;\r\n                        this.$message.success(res.data.msg);\r\n                    });\r\n                },\r\n                (error) => {\r\n                    this.$message.info('您已取消删除权限');\r\n                }\r\n            );\r\n        },\r\n        showSetPower(role) {\r\n            this.roleId = role.data.id;\r\n            console.log(this.roleId);\r\n            getLabelData().then((res) => {\r\n                if (res.data.code != 200) {\r\n                    return this.$message.error(res.data.msg);\r\n                }\r\n                this.labelTreeList = res.data.data;\r\n                this.powerDialog = true;\r\n                this.getRoledefKeys(role.data, this.defalutKeys);\r\n            });\r\n        },\r\n        getRoledefKeys(node, arr) {\r\n            if (node.label_level == 2) {\r\n                arr.push(node.id);\r\n            }\r\n            if (node.children) {\r\n                node.children.forEach((item) => {\r\n                    this.getRoledefKeys(item, arr);\r\n                });\r\n            }\r\n        },\r\n        setPowerDialogClosed() {\r\n            this.defalutKeys = [];\r\n            this.powerDialog = false;\r\n        },\r\n        setRolePower() {\r\n            const keys = [\r\n                ...this.$refs.treeRef.getCheckedKeys(),\r\n                ...this.$refs.treeRef.getHalfCheckedKeys(),\r\n            ];\r\n            const idStr = keys.join(',');\r\n            const params = {\r\n                role_id: this.roleId,\r\n                label_ids: idStr,\r\n            };\r\n            updateRoleLabel(params).then((res) => {\r\n                if (res.data.code !== 200) {\r\n                    return this.$message.error(res.data.msg);\r\n                }\r\n                this.getRoleData();\r\n                this.setPowerDialogClosed();\r\n                this.powerDialog = false;\r\n                return this.$message.success(res.data.msg);\r\n            });\r\n        },\r\n        cancelAddRoleDialog() {\r\n            this.addRoleDialog = false;\r\n            this.$refs.addFormRef.$refs.form.resetFields();\r\n        },\r\n        cancelUpdateRoleDialog() {\r\n            this.updateRoleDialog = false;\r\n            this.$refs.updateFormRef.$refs.form.resetFields();\r\n        },\r\n\r\n        addRole() {\r\n            createRole(this.addFormInfo.formFields).then((res) => {\r\n                if (res.data.code != 200) {\r\n                    return this.$message.error(res.data.msg);\r\n                }\r\n                this.cancelAddRoleDialog();\r\n                this.getRoleData();\r\n                return this.$message.success(res.data.msg);\r\n            });\r\n        },\r\n        removeRoleById(role_id) {\r\n            const params = { role_id };\r\n            this.$confirm('此操作将永久删除此角色, 是否继续?', '提示', {\r\n                confirmButtonText: '确定',\r\n                cancelButtonText: '取消',\r\n                type: 'warning',\r\n            }).then(\r\n                (res) => {\r\n                    deleteRole(params).then((res) => {\r\n                        if (res.data.code !== 200) {\r\n                            return this.$message.error(res.data.msg);\r\n                        }\r\n                        this.getRoleData();\r\n                        return this.$message.success(res.data.msg);\r\n                    });\r\n                },\r\n                (error) => this.$message.info('已取消删除角色')\r\n            );\r\n        },\r\n        showUpdateDialog(id) {\r\n            const params = { id };\r\n            getRoleDetail(params).then((res) => {\r\n                if (res.data.code !== 200) {\r\n                    return this.$message.error(res.data.msg);\r\n                }\r\n                this.updateRoleDialog = true;\r\n                this.updateFormInfo.formFields = res.data.data;\r\n            });\r\n        },\r\n        changeRoleInfo() {\r\n            updateRole(this.updateFormInfo.formFields).then((res) => {\r\n                if (res.data.code !== 200) {\r\n                    return this.$message.error(res.data.);\r\n                }\r\n                this.updateRoleDialog = false;\r\n                this.getRoleData();\r\n                return this.$message.success(res.data.msg);\r\n            });\r\n        },\r\n    },\r\n    components: {\r\n        Breadcrumb,\r\n        ReTable,\r\n        ReDialog,\r\n        ReForm,\r\n    },\r\n};\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n.row {\r\n    margin-top: 2px;\r\n}\r\n.el-tag {\r\n    margin: 7px;\r\n}\r\n.bd_bottom {\r\n    border-bottom: 1px solid #eee;\r\n}\r\n.bd_top {\r\n    border-top: 1px solid #eee;\r\n}\r\n.vcenter {\r\n    display: flex;\r\n    align-items: center;\r\n}\r\n</style>\r\n"]}]}